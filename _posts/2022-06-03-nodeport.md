---
title:  "ë…¸ë“œí¬íŠ¸(NodePort) ê°„ë‹¨ ì„¤ëª…"
excerpt: "ì‹œì‘ì´ ë°˜ì´ë‹¤. ê·¸ë˜ì„œ ì‹œì‘ì´ ê·¸ë ‡ê²Œ ì–´ë ¤ì› ë‚˜ë³´ë‹¤."

categories: k8s
tags: [Kubernetes, Featured]

toc: false
toc_sticky: false
 
date: 2022-06-03
last_modified_at: 2022-07-04
---

# ë…¸ë“œí¬íŠ¸ ê°„ë‹¨ ì†Œê°œ
ë…¸ë“œí¬íŠ¸(NodePort)ëŠ” ëª¨ë“  ì›Œì»¤ë…¸ë“œì˜ íŠ¹ì • í¬íŠ¸(=Nodeport)ë¥¼ ì—´ê³ , ì´ í¬íŠ¸ì— ì˜¤ëŠ” ëª¨ë“  ìš”ì²­ì„ ë…¸ë“œí¬íŠ¸ ì„œë¹„ìŠ¤ë¡œ í¬ì›Œë”©í•œë‹¤
<br>
í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì—ì„œ ì ‘ì† ë¶ˆê°€í•˜ë‹¤ëŠ” ClusterIP ì˜ ë‹¨ì ì„ í•´ê²°í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ì¤‘ì— ê°€ì¥ ì›ì‹œì ì¸(primitive) ë°©ë²•ì´ë‹¤.


## ë…¸ë“œí¬íŠ¸ì˜ íŠ¹ì§•
[![ë…¸ë“œí¬íŠ¸ íë¦„ë„](/assets/images/nodeport-img/np-flow.png)](https://drive.google.com/file/d/1a6cdsIMGK-mk4niVjIPZevB7c8HcLdq9/view?usp=sharing)

ì¹­ì°¬ ë§ì´ ë°›ì•˜ë˜ íšŒì‹¬ì˜ íë¦„ë„ğŸ˜ í´ë¦­í•˜ë©´ ê³ í™”ì§ˆë¡œ ì´ë™í•©ë‹ˆë‹¤.

- ë…¸ë“œí¬íŠ¸ë¡œ ë…¸ì¶œí•œë‹¤ëŠ” ê²ƒì€ ê³§ Podë‚˜ deploymentê°€ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤.
- ë…¸ë“œí¬íŠ¸ëŠ” ë…¸ë“œê°€ 3ê°œë“ , 100ê°œë“  ëª¨ë‘ ë™ì¼í•œ ë…¸ë“œí¬íŠ¸ê°€ ì—´ë ¤ì§„ë‹¤.
- ë…¸ë“œí¬íŠ¸ëŠ” 30000-32767 ì‚¬ì´ì˜ í¬íŠ¸ ëŒ€ì—­ì„ ì‚¬ìš©í•œë‹¤
- í¬íŠ¸(spec.ports.port) ëŠ” ì„œë¹„ìŠ¤ì— ëŒ€í•œ í¬íŠ¸ë²ˆí˜¸ë‹¤.
- íƒ€ê²Ÿí¬íŠ¸(spec.ports.targetPort)ëŠ” íŒŒë“œì˜ ì»¨í…Œì´ë„ˆì— ëŒ€í•œ í¬íŠ¸(spec.containers\[\].ports\[\].containerPort) ë²ˆí˜¸ë‹¤.
- íƒ€ê²Ÿí¬íŠ¸ì™€ í¬íŠ¸ëŠ” ë‹¤ë¥¸ ë²ˆí˜¸ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œëŠ” ë™ì¼í•œ ë²ˆí˜¸ë¡œ ë§ì¶°ì„œ ì‚¬ìš©í•œë‹¤
- ì–´ë–¤ Podë“¤ì„ ë…¸ì¶œì‹œí‚¤ëŠ”ì§€ëŠ” Selectorë¡œ ì§€ì •í•˜ë©°, ìë™ìœ¼ë¡œ Load Balancingëœë‹¤

## ë…¸ë“œí¬íŠ¸ì˜ ì œì•½ì‚¬í•­
ì•„ë˜ì™€ ê°™ì€ ì´ìœ ë¡œ ë…¸ë“œí¬íŠ¸ëŠ” ì£¼ë¡œ ì„ì‹œë‚˜ ë°ëª¨ì—ì„œë§Œ ì‚¬ìš©í•œë‹¤.<br>
- í•œ ë…¸ë“œí¬íŠ¸ë‹¹ í•œ ì„œë¹„ìŠ¤ë§Œ í• ë‹¹í•  ìˆ˜ ìˆë‹¤.
- ì™¸ë¶€ ì‚¬ìš©ìê°€ 80 í˜¹ì€ 443 ê°™ì€ Well-known ê°™ì€ í¬íŠ¸ê°€ ì•„ë‹ˆë¼, 30000-32767 ì‚¬ì´ì˜ í¬íŠ¸ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## ë…¸ë“œí¬íŠ¸ ë§Œë“œëŠ”ë²•
dp-nginx ë¼ëŠ” ì´ë¦„ì˜ Deploymentë¥¼ np-nginxë¼ëŠ” nodePortë¡œ ë…¸ì¶œí•˜ë ¤ê³  í•œë‹¤.<br>
ì´ë•Œ dp-nginx ì˜ yamlì€ ë‹¤ìŒê³¼ ê°™ë‹¤.<br>

```
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: dp-nginx
  name: dp-nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: dp-nginx
  template:
    metadata:
      labels:
        app: dp-nginx
    spec:
      containers:
      - name: nginx
        image: nginx
```

### yaml íŒŒì¼ë¡œ ë§Œë“¤ê¸°
ë…¸ë“œí¬íŠ¸ë¥¼ yamlë¡œ ìƒì„±í•˜ë©´ spec.ports.nodePortë¡œ ë…¸ë“œí¬íŠ¸ ë²ˆí˜¸ë¥¼, spec.selectorë¡œ Podë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤

```
apiVersion: v1
kind: Service
metadata:
  name: np-nginx 
spec:
  selector:
    app: dp-nginx  
  ports:
    - port: 80
      targetPort: 80
      nodePort: 30000 #option 
  type: NodePort
```

![](/assets/images/nodeport-img/np-by-vi-yaml-with-text.png)

### kubectl expose ëª…ë ¹ì–´ë¡œ ë§Œë“¤ê¸°
ë…¸ë“œí¬íŠ¸ë¥¼ exposeë¡œ ìƒì„±í•˜ë©´ PodëŠ” ì§€ì •í•  ìˆ˜ ìˆìœ¼ë‚˜, ë…¸ë“œí¬íŠ¸ ë²ˆí˜¸ëŠ” ì§€ì •í•  ìˆ˜ ì—†ë‹¤.(ëœë¤ ìƒì„±)
```
#ë°©ë²•
kubectl expose (-f FILENAME | TYPE NAME) [--port=port] [--protocol=TCP|UDP|SCTP] [--target-port=number-or-name]
[--name=name] [--external-ip=external-ip-of-service] [--type=type] [options]

#ì˜ˆì‹œ
kubectl expose deployment dp-nginx --type=NodePort --name=np-nginx --port=80 
```

![](/assets/images/nodeport-img/np-by-expose-command-with-text.png)

### kubectl create service ëª…ë ¹ì–´ë¡œ ë§Œë“¤ê¸°
ë…¸ë“œí¬íŠ¸ë¥¼ createë¡œ ìƒì„±í•˜ë©´ Podì™€ ë…¸ë“œí¬íŠ¸ ë²ˆí˜¸ ëª¨ë‘ ì§€ì •í•  ìˆ˜ ì—†ë‹¤.(ëœë¤ ìƒì„±)

```
#ë°©ë²•
kubectl create service nodeport NAME [--tcp=port:targetPort] [--dry-run=server|client|none] [options]

#ì˜ˆì‹œ
kubectl create service nodeport np-nginx --tcp=80:80
```

![](/assets/images/nodeport-img/np-by-create-command-with-text.png)

ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.Â 

<table><tbody><tr><td></td><td class="has-text-align-center" data-align="center">yaml</td><td class="has-text-align-center" data-align="center">expose</td><td class="has-text-align-center" data-align="center">create</td></tr><tr><td>nodePort ë²ˆí˜¸ ì§€ì •</td><td class="has-text-align-center" data-align="center">âœ…</td><td class="has-text-align-center" data-align="center">âŒ</td><td class="has-text-align-center" data-align="center">âŒ</td></tr><tr><td>Pod ì§€ì •</td><td class="has-text-align-center" data-align="center">âœ…</td><td class="has-text-align-center" data-align="center">âœ…</td><td class="has-text-align-center" data-align="center">âŒ</td></tr></tbody></table>

**âš ï¸exposeë‚˜ create ëª…ë ¹ì–´ë¡œ ìƒì„± í›„, kubectl editìœ¼ë¡œ í¸ì§‘í•  ìˆ˜ ìˆë‹¤.**

## ë…¸ë“œí¬íŠ¸ë¡œ ë…¸ì¶œí•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ê·¼í•˜ëŠ” ë°©ë²•
```
ì›Œì»¤ë…¸ë“œì˜IP:ë…¸ë“œí¬íŠ¸
```

í„°ë¯¸ë„ì—ì„œ curlë¡œ í™•ì¸í•˜ëŠ” ë°©ë²•
![](/assets/images/nodeport-img/np-curl.png)

ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸í•˜ëŠ” ë°©ë²•
![](/assets/images/nodeport-img/np-browser.png)

## ë…¸ë“œí¬íŠ¸ ìˆœì„œë„
![](/assets/images/nodeport-img/nodeport.gif)
~~ì‚¬ì‹¤ ì´ ì›€ì§¤ ì˜ ê·¸ë ¸ë‹¤ê³  ì¹­ì°¬ ë°›ê³  ì‹ ë‚˜ì„œ í¬ìŠ¤íŒ… ì¼ìŠµë‹ˆë‹¤.~~

## ì°¸ê³ 
- ê°•ì˜ [<ê·¸ë¦¼ìœ¼ë¡œ ë°°ìš°ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤(v1.22)>](https://www.inflearn.com/course/%EA%B7%B8%EB%A6%BC%EC%9C%BC%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4){:target="_blank"}Â 
- ì±… [<ì»¨í…Œì´ë„ˆ/ì¸í”„ë¼ í™˜ê²½ êµ¬ì¶•ì„ ìœ„í•œ ì¿ ë²„ë„¤í‹°ìŠ¤/ë„ì»¤>](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=273111259){:target="_blank"}
- ìŠ¤í„°ë”” [<ê°€ì‹œë‹¤ë‹˜ì˜ DKOS>](https://www.notion.so/DKOS-Docker-K8s-Online-Study-a92c52e0f8b14db082d5cdbf30b9540a){:target="_blank"}
- ë¬¸ì„œ [<í´ëŸ¬ìŠ¤í„° ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ì„œë¹„ìŠ¤ ì‚¬ìš©í•˜ê¸°>](https://kubernetes.io/ko/docs/tasks/access-application-cluster/service-access-application-cluster/){:target="_blank"}Â 
- [https://jerryljh.tistory.com/8](https://jerryljh.tistory.com/8){:target="_blank"}- [https://yoonchang.tistory.com/49](https://yoonchang.tistory.com/49){:target="_blank"}
- [https://blog.leocat.kr/notes/2019/08/22/translation-kubernetes-nodeport-vs-loadbalancer-vs-ingress](https://blog.leocat.kr/notes/2019/08/22/translation-kubernetes-nodeport-vs-loadbalancer-vs-ingress){:target="_blank"}
